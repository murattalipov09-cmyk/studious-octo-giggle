<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CRM –®–∫–æ–ª–∞ –ö–∏–∫–±–æ–∫—Å–∏–Ω–≥–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--tg-theme-bg-color, #f3f4f6);
            color: var(--tg-theme-text-color, #000);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .status-active {
            background: #10b981;
        }

        .status-inactive {
            background: #ef4444;
        }

        .status-trial {
            background: #f59e0b;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold">ü•ä CRM –®–∫–æ–ª–∞ –ö–∏–∫–±–æ–∫—Å–∏–Ω–≥–∞</h1>
            <p class="text-purple-100 mt-2">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–∞–º–∏ –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏</p>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        
        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-md p-2 mb-8 flex flex-wrap gap-2">
            <button onclick="switchTab('dashboard')" id="tab-dashboard" class="tab-active px-6 py-3 rounded-lg font-semibold transition">
                üìä –ì–ª–∞–≤–Ω–∞—è
            </button>
            <button onclick="switchTab('students')" id="tab-students" class="px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                üë• –£—á–µ–Ω–∏–∫–∏
            </button>
            <button onclick="switchTab('schedule')" id="tab-schedule" class="px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            </button>
            <button onclick="switchTab('payments')" id="tab-payments" class="px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                üí∞ –ü–ª–∞—Ç–µ–∂–∏
            </button>
            <button onclick="switchTab('attendance')" id="tab-attendance" class="px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">
                ‚úì –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="content-dashboard" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6 card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤</p>
                            <p class="text-3xl font-bold text-purple-600" id="total-students">0</p>
                        </div>
                        <div class="bg-purple-100 p-4 rounded-full">
                            <span class="text-3xl">üë•</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">–ê–∫—Ç–∏–≤–Ω—ã—Ö</p>
                            <p class="text-3xl font-bold text-green-600" id="active-students">0</p>
                        </div>
                        <div class="bg-green-100 p-4 rounded-full">
                            <span class="text-3xl">‚úì</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</p>
                            <p class="text-3xl font-bold text-blue-600" id="monthly-income">0 ‚ÇΩ</p>
                        </div>
                        <div class="bg-blue-100 p-4 rounded-full">
                            <span class="text-3xl">üí∞</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å–µ–≥–æ–¥–Ω—è</p>
                            <p class="text-3xl font-bold text-orange-600" id="today-classes">0</p>
                        </div>
                        <div class="bg-orange-100 p-4 rounded-full">
                            <span class="text-3xl">ü•ä</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                <div id="recent-activity" class="space-y-3">
                    <p class="text-gray-500">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                </div>
            </div>
        </div>

        <!-- Students Tab -->
        <div id="content-students" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex flex-wrap gap-4 justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏</h2>
                    <button onclick="openAddStudentModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                        + –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞
                    </button>
                </div>

                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="search-students" onkeyup="searchStudents()" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>

                <!-- Students List -->
                <div id="students-list" class="space-y-3">
                    <!-- Students will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Schedule Tab -->
        <div id="content-schedule" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex flex-wrap gap-4 justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
                    <button onclick="openAddClassModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                        + –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
                    </button>
                </div>

                <div id="schedule-list" class="space-y-4">
                    <!-- Schedule will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Payments Tab -->
        <div id="content-payments" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex flex-wrap gap-4 justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">–ü–ª–∞—Ç–µ–∂–∏</h2>
                    <button onclick="openAddPaymentModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                        + –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
                    </button>
                </div>

                <div id="payments-list" class="space-y-3">
                    <!-- Payments will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Attendance Tab -->
        <div id="content-attendance" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">–û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h2>
                
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É:</label>
                    <select id="attendance-class-select" onchange="loadAttendance()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É --</option>
                    </select>
                </div>

                <div id="attendance-list" class="space-y-3">
                    <p class="text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Add Student -->
    <div id="modal-add-student" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-4 text-gray-800">–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h3>
                <form id="form-add-student" onsubmit="addStudent(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–ò–º—è *</label>
                        <input type="text" id="student-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                        <input type="tel" id="student-phone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">Email</label>
                        <input type="email" id="student-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–í–æ–∑—Ä–∞—Å—Ç</label>
                        <input type="number" id="student-age" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–°—Ç–∞—Ç—É—Å *</label>
                        <select id="student-status" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="trial">–ü—Ä–æ–±–Ω—ã–π</option>
                            <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 font-semibold mb-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea id="student-notes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" onclick="closeModal('modal-add-student')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-3 rounded-lg font-semibold transition">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Add Class -->
    <div id="modal-add-class" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-4 text-gray-800">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h3>
                <form id="form-add-class" onsubmit="addClass(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="class-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ *</label>
                        <select id="class-day" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                            <option value="–í—Ç–æ—Ä–Ω–∏–∫">–í—Ç–æ—Ä–Ω–∏–∫</option>
                            <option value="–°—Ä–µ–¥–∞">–°—Ä–µ–¥–∞</option>
                            <option value="–ß–µ—Ç–≤–µ—Ä–≥">–ß–µ—Ç–≤–µ—Ä–≥</option>
                            <option value="–ü—è—Ç–Ω–∏—Ü–∞">–ü—è—Ç–Ω–∏—Ü–∞</option>
                            <option value="–°—É–±–±–æ—Ç–∞">–°—É–±–±–æ—Ç–∞</option>
                            <option value="–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–í—Ä–µ–º—è *</label>
                        <input type="time" id="class-time" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–¢—Ä–µ–Ω–µ—Ä *</label>
                        <input type="text" id="class-trainer" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 font-semibold mb-2">–ú–∞–∫—Å–∏–º—É–º —É—á–µ–Ω–∏–∫–æ–≤</label>
                        <input type="number" id="class-max" value="15" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" onclick="closeModal('modal-add-class')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-3 rounded-lg font-semibold transition">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Add Payment -->
    <div id="modal-add-payment" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <h3 class="text-2xl font-bold mb-4 text-gray-800">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂</h3>
                <form id="form-add-payment" onsubmit="addPayment(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–£—á–µ–Ω–∏–∫ *</label>
                        <select id="payment-student" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ --</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–°—É–º–º–∞ (‚ÇΩ) *</label>
                        <input type="number" id="payment-amount" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">–î–∞—Ç–∞ *</label>
                        <input type="date" id="payment-date" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 font-semibold mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <input type="text" id="payment-description" placeholder="–ê–±–æ–Ω–µ–º–µ–Ω—Ç –Ω–∞ –º–µ—Å—è—Ü" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition">
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                        <button type="button" onclick="closeModal('modal-add-payment')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-3 rounded-lg font-semibold transition">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let students = [];
        let classes = [];
        let payments = [];
        let attendance = [];

        // Load data from localStorage
        function loadData() {
            const savedStudents = localStorage.getItem('kickboxing-students');
            const savedClasses = localStorage.getItem('kickboxing-classes');
            const savedPayments = localStorage.getItem('kickboxing-payments');
            const savedAttendance = localStorage.getItem('kickboxing-attendance');

            if (savedStudents) students = JSON.parse(savedStudents);
            if (savedClasses) classes = JSON.parse(savedClasses);
            if (savedPayments) payments = JSON.parse(savedPayments);
            if (savedAttendance) attendance = JSON.parse(savedAttendance);

            // Add demo data if empty
            if (students.length === 0) {
                addDemoData();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('kickboxing-students', JSON.stringify(students));
            localStorage.setItem('kickboxing-classes', JSON.stringify(classes));
            localStorage.setItem('kickboxing-payments', JSON.stringify(payments));
            localStorage.setItem('kickboxing-attendance', JSON.stringify(attendance));
        }

        // Add demo data
        function addDemoData() {
            students = [
                {id: 1, name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', phone: '+7 (999) 123-45-67', email: 'ivan@mail.ru', age: 25, status: 'active', notes: '–û–ø—ã—Ç–Ω—ã–π —Å–ø–æ—Ä—Ç—Å–º–µ–Ω', createdAt: new Date().toISOString()},
                {id: 2, name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', phone: '+7 (999) 234-56-78', email: 'maria@mail.ru', age: 22, status: 'active', notes: '', createdAt: new Date().toISOString()},
                {id: 3, name: '–î–º–∏—Ç—Ä–∏–π –ö–æ–≤–∞–ª–µ–≤', phone: '+7 (999) 345-67-89', email: '', age: 18, status: 'trial', notes: '–ü—Ä–æ–±–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ', createdAt: new Date().toISOString()}
            ];

            classes = [
                {id: 1, name: '–ù–∞—á–∏–Ω–∞—é—â–∏–µ', day: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', time: '18:00', trainer: '–°–µ—Ä–≥–µ–π –ò–≤–∞–Ω–æ–≤', maxStudents: 15},
                {id: 2, name: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ', day: '–°—Ä–µ–¥–∞', time: '19:00', trainer: '–°–µ—Ä–≥–µ–π –ò–≤–∞–Ω–æ–≤', maxStudents: 12},
                {id: 3, name: '–î–µ—Ç—Å–∫–∞—è –≥—Ä—É–ø–ø–∞', day: '–°—É–±–±–æ—Ç–∞', time: '10:00', trainer: '–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞', maxStudents: 20}
            ];

            payments = [
                {id: 1, studentId: 1, studentName: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', amount: 5000, date: new Date().toISOString().split('T')[0], description: '–ê–±–æ–Ω–µ–º–µ–Ω—Ç –Ω–∞ –º–µ—Å—è—Ü'},
                {id: 2, studentId: 2, studentName: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', amount: 5000, date: new Date().toISOString().split('T')[0], description: '–ê–±–æ–Ω–µ–º–µ–Ω—Ç –Ω–∞ –º–µ—Å—è—Ü'}
            ];

            saveData();
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Remove active class from all buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('hover:bg-gray-100');
            });

            // Show selected tab
            document.getElementById('content-' + tabName).classList.remove('hidden');
            document.getElementById('content-' + tabName).classList.add('fade-in');

            // Add active class to selected button
            const activeBtn = document.getElementById('tab-' + tabName);
            activeBtn.classList.add('tab-active');
            activeBtn.classList.remove('hover:bg-gray-100');

            // Render content based on tab
            if (tabName === 'dashboard') renderDashboard();
            if (tabName === 'students') renderStudents();
            if (tabName === 'schedule') renderSchedule();
            if (tabName === 'payments') {
                renderPayments();
                populatePaymentStudentSelect();
            }
            if (tabName === 'attendance') {
                populateAttendanceClassSelect();
            }
        }

        // Render Dashboard
        function renderDashboard() {
            const totalStudents = students.length;
            const activeStudents = students.filter(s => s.status === 'active').length;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyIncome = payments
                .filter(p => {
                    const paymentDate = new Date(p.date);
                    return paymentDate.getMonth() === currentMonth && paymentDate.getFullYear() === currentYear;
                })
                .reduce((sum, p) => sum + p.amount, 0);

            const today = new Date().toLocaleDateString('ru-RU', {weekday: 'long'});
            const todayClasses = classes.filter(c => c.day.toLowerCase() === today.toLowerCase()).length;

            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('active-students').textContent = activeStudents;
            document.getElementById('monthly-income').textContent = monthlyIncome.toLocaleString('ru-RU') + ' ‚ÇΩ';
            document.getElementById('today-classes').textContent = todayClasses;

            // Recent activity
            let activityHTML = '';
            const recentPayments = payments.slice(-5).reverse();
            
            if (recentPayments.length > 0) {
                recentPayments.forEach(p => {
                    activityHTML += `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üí∞</span>
                                <div>
                                    <p class="font-semibold">${p.studentName}</p>
                                    <p class="text-sm text-gray-500">${p.description || '–ü–ª–∞—Ç–µ–∂'}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-green-600">+${p.amount.toLocaleString('ru-RU')} ‚ÇΩ</p>
                                <p class="text-sm text-gray-500">${new Date(p.date).toLocaleDateString('ru-RU')}</p>
                            </div>
                        </div>
                    `;
                });
            } else {
                activityHTML = '<p class="text-gray-500">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>';
            }

            document.getElementById('recent-activity').innerHTML = activityHTML;
        }

        // Render Students
        function renderStudents() {
            const container = document.getElementById('students-list');
            
            if (students.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞!</p>';
                return;
            }

            let html = '';
            students.forEach(student => {
                const statusClass = student.status === 'active' ? 'status-active' : 
                                   student.status === 'trial' ? 'status-trial' : 'status-inactive';
                const statusText = student.status === 'active' ? '–ê–∫—Ç–∏–≤–Ω—ã–π' : 
                                  student.status === 'trial' ? '–ü—Ä–æ–±–Ω—ã–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π';

                html += `
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition card">
                        <div class="flex flex-wrap gap-4 justify-between items-start">
                            <div class="flex-1 min-w-[200px]">
                                <h3 class="text-lg font-bold text-gray-800">${student.name}</h3>
                                <p class="text-gray-600 text-sm mt-1">üì± ${student.phone}</p>
                                ${student.email ? `<p class="text-gray-600 text-sm">‚úâÔ∏è ${student.email}</p>` : ''}
                                ${student.age ? `<p class="text-gray-600 text-sm">üéÇ ${student.age} –ª–µ—Ç</p>` : ''}
                                ${student.notes ? `<p class="text-gray-500 text-sm mt-2 italic">${student.notes}</p>` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <span class="${statusClass} text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    ${statusText}
                                </span>
                                <button onclick="deleteStudent(${student.id})" class="text-red-600 hover:text-red-800 text-sm font-semibold">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Search students
        function searchStudents() {
            const searchTerm = document.getElementById('search-students').value.toLowerCase();
            const filteredStudents = students.filter(s => 
                s.name.toLowerCase().includes(searchTerm) || 
                s.phone.toLowerCase().includes(searchTerm) ||
                (s.email && s.email.toLowerCase().includes(searchTerm))
            );

            const container = document.getElementById('students-list');
            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }

            let html = '';
            filteredStudents.forEach(student => {
                const statusClass = student.status === 'active' ? 'status-active' : 
                                   student.status === 'trial' ? 'status-trial' : 'status-inactive';
                const statusText = student.status === 'active' ? '–ê–∫—Ç–∏–≤–Ω—ã–π' : 
                                  student.status === 'trial' ? '–ü—Ä–æ–±–Ω—ã–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π';

                html += `
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition card">
                        <div class="flex flex-wrap gap-4 justify-between items-start">
                            <div class="flex-1 min-w-[200px]">
                                <h3 class="text-lg font-bold text-gray-800">${student.name}</h3>
                                <p class="text-gray-600 text-sm mt-1">üì± ${student.phone}</p>
                                ${student.email ? `<p class="text-gray-600 text-sm">‚úâÔ∏è ${student.email}</p>` : ''}
                                ${student.age ? `<p class="text-gray-600 text-sm">üéÇ ${student.age} –ª–µ—Ç</p>` : ''}
                                ${student.notes ? `<p class="text-gray-500 text-sm mt-2 italic">${student.notes}</p>` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <span class="${statusClass} text-white px-3 py-1 rounded-full text-sm font-semibold">
                                    ${statusText}
                                </span>
                                <button onclick="deleteStudent(${student.id})" class="text-red-600 hover:text-red-800 text-sm font-semibold">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Render Schedule
        function renderSchedule() {
            const container = document.getElementById('schedule-list');
            
            if (classes.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">–ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É!</p>';
                return;
            }

            const daysOrder = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
            const sortedClasses = [...classes].sort((a, b) => {
                return daysOrder.indexOf(a.day) - daysOrder.indexOf(b.day);
            });

            let html = '';
            sortedClasses.forEach(cls => {
                html += `
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition card">
                        <div class="flex flex-wrap gap-4 justify-between items-start">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-800">ü•ä ${cls.name}</h3>
                                <p class="text-gray-600 mt-2">üìÖ ${cls.day} –≤ ${cls.time}</p>
                                <p class="text-gray-600">üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä: ${cls.trainer}</p>
                                <p class="text-gray-600">üë• –ú–∞–∫—Å–∏–º—É–º: ${cls.maxStudents} —á–µ–ª–æ–≤–µ–∫</p>
                            </div>
                            <button onclick="deleteClass(${cls.id})" class="text-red-600 hover:text-red-800 text-sm font-semibold">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Render Payments
        function renderPayments() {
            const container = document.getElementById('payments-list');
            
            if (payments.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">–ù–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π</p>';
                return;
            }

            let html = '';
            const sortedPayments = [...payments].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedPayments.forEach(payment => {
                html += `
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition card">
                        <div class="flex flex-wrap gap-4 justify-between items-center">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-800">${payment.studentName}</h3>
                                <p class="text-gray-600 text-sm mt-1">${payment.description || '–ü–ª–∞—Ç–µ–∂'}</p>
                                <p class="text-gray-500 text-sm">${new Date(payment.date).toLocaleDateString('ru-RU')}</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-2xl font-bold text-green-600">${payment.amount.toLocaleString('ru-RU')} ‚ÇΩ</span>
                                <button onclick="deletePayment(${payment.id})" class="text-red-600 hover:text-red-800 text-sm font-semibold">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Populate payment student select
        function populatePaymentStudentSelect() {
            const select = document.getElementById('payment-student');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ --</option>';
            
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.name}</option>`;
            });
        }

        // Populate attendance class select
        function populateAttendanceClassSelect() {
            const select = document.getElementById('attendance-class-select');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É --</option>';
            
            classes.forEach(cls => {
                select.innerHTML += `<option value="${cls.id}">${cls.name} - ${cls.day} ${cls.time}</option>`;
            });
        }

        // Load attendance
        function loadAttendance() {
            const classId = parseInt(document.getElementById('attendance-class-select').value);
            const container = document.getElementById('attendance-list');
            
            if (!classId) {
                container.innerHTML = '<p class="text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</p>';
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            
            let html = '';
            students.filter(s => s.status === 'active').forEach(student => {
                const attended = attendance.find(a => 
                    a.studentId === student.id && 
                    a.classId === classId && 
                    a.date === today
                );

                html += `
                    <div class="border border-gray-200 rounded-lg p-4 flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-gray-800">${student.name}</h3>
                            <p class="text-sm text-gray-600">${student.phone}</p>
                        </div>
                        <button 
                            onclick="toggleAttendance(${student.id}, ${classId}, '${today}')"
                            class="px-6 py-2 rounded-lg font-semibold transition ${attended ? 'bg-green-500 hover:bg-green-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'}"
                        >
                            ${attended ? '‚úì –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª' : '–û—Ç–º–µ—Ç–∏—Ç—å'}
                        </button>
                    </div>
                `;
            });

            if (html === '') {
                html = '<p class="text-gray-500">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤</p>';
            }

            container.innerHTML = html;
        }

        // Toggle attendance
        function toggleAttendance(studentId, classId, date) {
            const index = attendance.findIndex(a => 
                a.studentId === studentId && 
                a.classId === classId && 
                a.date === date
            );

            if (index > -1) {
                attendance.splice(index, 1);
            } else {
                const student = students.find(s => s.id === studentId);
                attendance.push({
                    studentId,
                    studentName: student.name,
                    classId,
                    date
                });
            }

            saveData();
            loadAttendance();
        }

        // Modal functions
        function openAddStudentModal() {
            document.getElementById('modal-add-student').classList.remove('hidden');
            document.getElementById('modal-add-student').classList.add('flex');
        }

        function openAddClassModal() {
            document.getElementById('modal-add-class').classList.remove('hidden');
            document.getElementById('modal-add-class').classList.add('flex');
        }

        function openAddPaymentModal() {
            populatePaymentStudentSelect();
            document.getElementById('payment-date').valueAsDate = new Date();
            document.getElementById('modal-add-payment').classList.remove('hidden');
            document.getElementById('modal-add-payment').classList.add('flex');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        // Add student
        function addStudent(e) {
            e.preventDefault();
            
            const student = {
                id: Date.now(),
                name: document.getElementById('student-name').value,
                phone: document.getElementById('student-phone').value,
                email: document.getElementById('student-email').value,
                age: document.getElementById('student-age').value,
                status: document.getElementById('student-status').value,
                notes: document.getElementById('student-notes').value,
                createdAt: new Date().toISOString()
            };

            students.push(student);
            saveData();
            
            document.getElementById('form-add-student').reset();
            closeModal('modal-add-student');
            renderStudents();
            renderDashboard();

            alert('‚úÖ –£—á–µ–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
        }

        // Delete student
        function deleteStudent(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞?')) {
                students = students.filter(s => s.id !== id);
                saveData();
                renderStudents();
                renderDashboard();
            }
        }

        // Add class
        function addClass(e) {
            e.preventDefault();
            
            const newClass = {
                id: Date.now(),
                name: document.getElementById('class-name').value,
                day: document.getElementById('class-day').value,
                time: document.getElementById('class-time').value,
                trainer: document.getElementById('class-trainer').value,
                maxStudents: parseInt(document.getElementById('class-max').value)
            };

            classes.push(newClass);
            saveData();
            
            document.getElementById('form-add-class').reset();
            closeModal('modal-add-class');
            renderSchedule();
            renderDashboard();

            alert('‚úÖ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        // Delete class
        function deleteClass(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) {
                classes = classes.filter(c => c.id !== id);
                saveData();
                renderSchedule();
                renderDashboard();
            }
        }

        // Add payment
        function addPayment(e) {
            e.preventDefault();
            
            const studentId = parseInt(document.getElementById('payment-student').value);
            const student = students.find(s => s.id === studentId);

            const payment = {
                id: Date.now(),
                studentId: studentId,
                studentName: student.name,
                amount: parseInt(document.getElementById('payment-amount').value),
                date: document.getElementById('payment-date').value,
                description: document.getElementById('payment-description').value
            };

            payments.push(payment);
            saveData();
            
            document.getElementById('form-add-payment').reset();
            closeModal('modal-add-payment');
            renderPayments();
            renderDashboard();

            alert('‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
        }

        // Delete payment
        function deletePayment(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞—Ç–µ–∂?')) {
                payments = payments.filter(p => p.id !== id);
                saveData();
                renderPayments();
                renderDashboard();
            }
        }

        // Initialize app
        function init() {
            loadData();
            renderDashboard();
            renderStudents();
        }

        // Telegram WebApp initialization
        let tg = window.Telegram?.WebApp;
        
        function initTelegramWebApp() {
            if (tg) {
                // Expand the web app to full height
                tg.expand();
                
                // Enable closing confirmation
                tg.enableClosingConfirmation();
                
                // Set header color
                tg.setHeaderColor('#7c3aed');
                
                // Show main button for quick actions
                tg.MainButton.setText('–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞');
                tg.MainButton.onClick(() => openAddStudentModal());
                
                // Get user data if available
                if (tg.initDataUnsafe?.user) {
                    console.log('Telegram User:', tg.initDataUnsafe.user);
                }
                
                // Send data back to bot (optional)
                window.sendDataToBot = function(data) {
                    tg.sendData(JSON.stringify(data));
                };
            }
        }

        // Run on page load
        window.addEventListener('DOMContentLoaded', () => {
            initTelegramWebApp();
            init();
        });
    </script>
</body>
</html>